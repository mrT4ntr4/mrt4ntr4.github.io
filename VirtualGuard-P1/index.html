<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="article">
<meta property="og:title" content="A Tale of .Net Deobfuscation - VirtualGuard Basics">
<meta property="og:url" content="https://mrt4ntr4.github.io/VirtualGuard-P1/index.html">
<meta property="og:site_name" content="mrT4ntr4&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/crackme_execution.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/cf.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/ildg.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/cf_transformed.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/pc1.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/pc2.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/proxyil_dg.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/proxy_il.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/proxy_calls.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/anti-debug-deob.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/implmap.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/anti-tamper-deob.png">
<meta property="og:image" content="https://mrt4ntr4.github.io/img/virtualguard1/checksum.png">
<meta property="article:published_time" content="2023-03-26T22:00:00.000Z">
<meta property="article:modified_time" content="2023-04-07T07:25:14.887Z">
<meta property="article:author" content="Suraj Malhotra">
<meta property="article:tag" content=".Net">
<meta property="article:tag" content="Obfuscation">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mrt4ntr4.github.io/img/virtualguard1/crackme_execution.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.png">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
        
      
    
    <!-- title -->
    <title>A Tale of .Net Deobfuscation - VirtualGuard Basics</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/feed.xml" title="mrT4ntr4&#39;s Blog" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.3.0"></head>

<div class="background">
    <div class="banner">
<div id="blogtitle" class="blogtitle">mrT4ntr4&#39;s Blog</div>
<ul id="wrapper" class="wrapper">
  <div class="sun">
    <div class="star"></div>
  </div>
  <div class="mercury">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="venus">
    <div class="planet">
      <div class="shadow"></div>
    </div>
  </div>
  <div class="earth">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="mars">
    <div class="planet"><div class="shadow"></div></div>
  </div>
  <div class="jupiter">
    <div class="planet"><div class="shadow"></div></div>
  </div>
</ul>
</div>

    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/categories/">Category</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/VirtualGuard-P2/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/MODeflattener/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://mrt4ntr4.github.io/VirtualGuard-P1/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&text=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&is_video=false&description=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=A Tale of .Net Deobfuscation - VirtualGuard Basics&body=Check out this article: https://mrt4ntr4.github.io/VirtualGuard-P1/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&name=A Tale of .Net Deobfuscation - VirtualGuard Basics&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://mrt4ntr4.github.io/VirtualGuard-P1/&t=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Initial-Analysis-%F0%9F%94%8D"><span class="toc-number">2.</span> <span class="toc-text">Initial Analysis üîç</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Writing-a-de4dot-Plugin-%F0%9F%94%8C"><span class="toc-number">3.</span> <span class="toc-text">Writing a de4dot Plugin üîå</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cleaning-Control-Flow-%F0%9F%A7%B9"><span class="toc-number">4.</span> <span class="toc-text">Cleaning Control Flow üßπ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fixing-Proxy-Calls-%E2%9B%93%EF%B8%8F"><span class="toc-number">5.</span> <span class="toc-text">Fixing Proxy Calls ‚õìÔ∏è</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Anti-Debug-Remover-%F0%9F%90%9E"><span class="toc-number">6.</span> <span class="toc-text">Anti Debug Remover üêû</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Anti-Tamper-Remover-%F0%9F%94%A8"><span class="toc-number">7.</span> <span class="toc-text">Anti Tamper Remover üî®</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Success-%F0%9F%92%AA"><span class="toc-number">8.</span> <span class="toc-text">Success! üí™</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#References-%F0%9F%93%9A"><span class="toc-number">9.</span> <span class="toc-text">References üìö</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        A Tale of .Net Deobfuscation - VirtualGuard Basics
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Suraj Malhotra</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-03-26T22:00:00.000Z" itemprop="datePublished">2023-03-27</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/Tools/">Tools</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Net/" rel="tag">.Net</a>, <a class="tag-link-link" href="/tags/Obfuscation/" rel="tag">Obfuscation</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css" /><div class=".article-gallery"<hr>
<blockquote>
<p>This part focuses more on the basic obfuscation techniques used in .Net samples such as Control flow Obfuscation, Proxy Calls, Anti Debug and Anti Tamper. I write a de4dot plugin for VirtualGuard that patches the .Net binary and removes all the protections except VM Devirtualization.<br>For more on VM Devirtualization, You can move on to the <a href="/VirtualGuard-P2/">next part</a> in the series.</p>
</blockquote>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Well I was thinking of doing a writeup of the flareon #8 challenge ie. Backdoor, but then I got inspired to dig more into .Net obfuscation. Browsing through crackmes.one a <a target="_blank" rel="noopener" href="https://crackmes.one/crackme/63e05bd333c5d447bc76123a">crackme</a> featuring ‚Äú<a target="_blank" rel="noopener" href="https://virtualguard.io/"><strong>VirtualGuard</strong></a>‚Äú protector, caught my eye as it was pretty new and unsolved. </p>
<p>In the end, I solved it through debugging but had a motivation to develop some tooling for it. I contacted mito on discord and told him about it. He shared his insights on it and I was set off for doing some more research on .Net protectors. During this time I read about various VM based protectors such as MemeVM, KoiVM, eazfuscator, etc. I was astonished by the tool ‚ÄúOldRod‚Äù ie. KoiVM Devirtualization Utility developed by Washi and began reading its source code. Days passed by and I get a message from Mito that he has developed a new VM which is more difficult than the SpiderVM. I was excited for it and planned to write a tool for VirtualGuard this time. I wrote a disassembler initially and Mito motivated me to do a full Devirt of it. </p>
<blockquote>
<p>The crackmes can be downloaded from the following links :<br><a href="/files/virtualguard/test-guarded_spider.exe"><strong>Spider VM</strong> üï∏</a>  |  <a href="/files/virtualguard/test-guarded_croc.exe"><strong>Crocodile VM</strong> üêä</a></p>
</blockquote>
<hr>
<h1 id="Initial-Analysis-üîç"><a href="#Initial-Analysis-üîç" class="headerlink" title="Initial Analysis üîç"></a>Initial Analysis üîç</h1><p>Both of them are typical keygenme challenges. Crocodile crackme asks for a username and password whereas Spider crackme asks for a license key.  </p>
<p><a href="/img/virtualguard1/crackme_execution.png" class="gallery-item"><img src="/img/virtualguard1/crackme_execution.png"></a></p>
<p>We can analyze the executables in <a target="_blank" rel="noopener" href="https://github.com/dnSpyEx/dnSpy">dnspy</a>. The control flow of all methods is obfuscated.  </p>
<p><a href="/img/virtualguard1/cf.png" class="gallery-item"><img src="/img/virtualguard1/cf.png"></a></p>
<p>There is a state variable which is modified subsequently in different ways using arrays and conditions. At first it looked easy and I began writing a tool to debofuscate it.  </p>
<p><a href="/img/virtualguard1/ildg.png" class="gallery-item"><img src="/img/virtualguard1/ildg.png"></a></p>
<p>We can look at the IL Instructions of the array assignments in dnspy.<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/api/system.reflection.emit.opcodes?view=net-6.0"><em>Here</em></a> is a good documentation of CIL Opcodes on MSDN. I wrote some code to get all the operation opcodes ie. Add/Sub and array constant assignments in order. </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Instruction curIns = chunkIns[i];</span><br><span class="line">Instruction nextIns = chunkIns[i + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (nextIns.OpCode == OpCodes.Add</span><br><span class="line">    || nextIns.OpCode == OpCodes.Sub)</span><br><span class="line">&#123;</span><br><span class="line">    opcodeList.Add(nextIns.OpCode);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (curIns.OpCode == OpCodes.Ldc_I4</span><br><span class="line">   &amp;&amp; nextIns.OpCode == OpCodes.Ldc_I4)</span><br><span class="line">&#123;</span><br><span class="line">    arrayList.Add((<span class="built_in">uint</span>)nextIns.GetLdcI4Value());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now the underlying algorithm for the array pass is quite simple. We can calculate the values in the array and therefore we have the resulting state variable value using the following code.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> List&lt;<span class="built_in">uint</span>&gt; <span class="title">CalculateArray</span>(<span class="params">List&lt;OpCode&gt; opcodeList, List&lt;<span class="built_in">uint</span>&gt; arrayList</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; arrayList.Count - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> k = i; k &gt;= <span class="number">0</span>; k--)</span><br><span class="line">        &#123;</span><br><span class="line">            OpCode op = opcodeList[j++];</span><br><span class="line">            <span class="keyword">if</span> (op == OpCodes.Add) arrayList[i + <span class="number">1</span>] = arrayList[i + <span class="number">1</span>] + arrayList[k];</span><br><span class="line">            <span class="keyword">if</span> (op == OpCodes.Sub) arrayList[i + <span class="number">1</span>] = arrayList[i + <span class="number">1</span>] - arrayList[k];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arrayList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There were some conditional passes as well ie. the next value of state variable depended on a previous evaluated condition. At this point, I asked mito about it and he told its just a mod of <a target="_blank" rel="noopener" href="https://github.com/yck1509/ConfuserEx">ConfuserEx</a> lol. So I tried it and to my surprise it was quite similar except that array pass not being included in it. Now obviously as ConfuserEx is quite old, it would have some deobfuscation tools as well. I searched and found <a target="_blank" rel="noopener" href="https://github.com/VAllens/ConfuserExSwitchKiller">ConfuserEx Switch Killer</a> which does a good job at deobfuscating control flow for ConfuserEx but the code is very hard to debug and understand. I also found <a target="_blank" rel="noopener" href="https://github.com/ViRb3/de4dot-cex">de4dot-cex</a> which emulates certain instructions and calculates the value of the state variable and thus the target switch block. BTW, ConfuserExSwitchKiller had multiple uses of de4dot.blocks to deobfuscate the blocks at different stages as well. I also found some Anti-Debug and Anti-Tamper methods in the crackme, so I thought why not write a de4dot plugin for VirtualGuard. </p>
<h1 id="Writing-a-de4dot-Plugin-üîå"><a href="#Writing-a-de4dot-Plugin-üîå" class="headerlink" title="Writing a de4dot Plugin üîå"></a>Writing a de4dot Plugin üîå</h1><p>The directory structure for the deobfuscators looks like the following</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">üìÇde4dot</span><br><span class="line">üìÇde4dot.code</span><br><span class="line">|__üìÇdeobfuscators</span><br><span class="line">   |__üìÅConfuserEx</span><br><span class="line">   |__üìÇVirtualGuard</span><br><span class="line">   |  |-- üóã Deobfuscator.cs</span><br><span class="line">   |__üìÅUnknown</span><br></pre></td></tr></table></figure>
<p>You could read the ‚Äú<strong><em>Unknown</em></strong>‚Äú Deobfuscator code to understand the basic code structure for a deobfuscator plugin.</p>
<p>Basically first we need to detect the protection used in the executable so we check it in the following manner.  </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DetectVirtualGuard</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    List&lt;<span class="built_in">string</span>&gt; VMNames = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123; <span class="string">&quot;crocodile&quot;</span>, <span class="string">&quot;spider&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (module.Name != <span class="string">&quot;ùôëùôûùôßùô©ùô™ùôñùô°ùôÇùô™ùôñùôßùôô&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> res <span class="keyword">in</span> module.Resources)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(VMNames.Contains(res.Name))</span><br><span class="line">            _detectedVirtualGuard = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We match the module name (which is same for both of the crackmes) and check whether the specific named resources are present in the executable.  </p>
<blockquote>
<p>üí° Do not forget to override the MetaDataFlags and set them to PreserveAll as it is very important here as deobfuscation seems to mess up the metadata tables like MemberRef table.  </p>
</blockquote>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> MetaDataFlags MetaDataFlags =&gt; MetaDataFlags.PreserveAll;</span><br></pre></td></tr></table></figure>
<h1 id="Cleaning-Control-Flow-üßπ"><a href="#Cleaning-Control-Flow-üßπ" class="headerlink" title="Cleaning Control Flow üßπ"></a>Cleaning Control Flow üßπ</h1><p>Our control flow deobfuscator is similar to the ConfuserEx plugin with modifications to the Instruction Emulator for de4dot.blocks like adding instructions such as <em>newarr, stelem.i4, ldelem.i4</em> and noping out the unused array instructions in the end. </p>
<p>For eg. the emulation for <strong>ldelem.i4</strong> instruction looks like the following. </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Emulate_Ldelem_I4</span>(<span class="params">Instruction instr</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Int32Value idx = (Int32Value)valueStack.Pop();</span><br><span class="line">    ObjectValue arrobj = (ObjectValue)valueStack.Pop();</span><br><span class="line">    List&lt;Value&gt; arr = (List&lt;Value&gt;)arrobj.obj;</span><br><span class="line">    valueStack.Push(arr[idx.Value]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>From MSDN docs, stack transition of ldelem.i4 instruction is :</em></p>
<ol>
<li><strong>index</strong> and <strong>array</strong> are <strong>popped</strong> from the stack; the value stored at position index in array is looked up.</li>
<li>The <strong>value</strong> is <strong>pushed</strong> onto the stack.</li>
</ol>
<p>We emulate every switch case block and calculate the next state variable using emulation.<br>The <code>ProcessBlock</code> function looks like the following : </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> targets = switchBlock.Targets;</span><br><span class="line"></span><br><span class="line">_instructionEmulator.Emulate(block.Instructions, <span class="number">0</span>, block.Instructions.Count);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_instructionEmulator.Peek().IsUnknown())</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;CRITICAL ERROR: STACK VALUE UNKNOWN&quot;</span>);</span><br><span class="line"><span class="comment">//Logger.v(&quot;Emulated Result : &quot; + _instructionEmulator.Peek());</span></span><br><span class="line"><span class="built_in">int</span>? key = CalculateKey(switchBlock.SwitchData);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!key.HasValue)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;CRITICAL ERROR: KEY HAS NO VALUE&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span>? switchCaseIndex = CalculateSwitchCaseIndex(switchBlock, switchBlock.SwitchData, key.Value);</span><br><span class="line"><span class="keyword">if</span> (!switchCaseIndex.HasValue)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;CRITICAL ERROR: SWITCH CASE HAS NO VALUE&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (targets.Count &lt; switchCaseIndex)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;CRITICAL ERROR: KEY OUT OF RANGE&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> targetBlock = targets[switchCaseIndex.Value];</span><br></pre></td></tr></table></figure>
<p>In the end, we can nop out the array assignments as well. Here is the result of the control flow deobfuscation pass on a method. Cheers! üçª</p>
<p><a href="/img/virtualguard1/cf_transformed.png" class="gallery-item"><img src="/img/virtualguard1/cf_transformed.png"></a></p>
<h1 id="Fixing-Proxy-Calls-‚õìÔ∏è"><a href="#Fixing-Proxy-Calls-‚õìÔ∏è" class="headerlink" title="Fixing Proxy Calls ‚õìÔ∏è"></a>Fixing Proxy Calls ‚õìÔ∏è</h1><p>Some methods call specific functions for eg. <code>ed.f3()</code>. These method calls hide the original method being called and therefore we‚Äôll refer to them Proxy calls here.  </p>
<p><a href="/img/virtualguard1/pc1.png" class="gallery-item"><img src="/img/virtualguard1/pc1.png"></a></p>
<p>They are resolved from an array of objects (ie. <code>object[] 9.5d5</code>) initialized in the constructor in this case.  </p>
<p><a href="/img/virtualguard1/pc2.png" class="gallery-item"><img src="/img/virtualguard1/pc2.png"></a></p>
<p>So we just need to replace the proxied usages of these methods. Easy! Lets get to work.<br>There are several markers for various stages in deobfuscation in de4dot. </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DeobfuscateBegin()</span><br><span class="line">DeobfuscateMethodBegin()</span><br><span class="line">DeobfuscateMethodEnd()</span><br><span class="line">DeobfuscateEnd()</span><br></pre></td></tr></table></figure>
<p>I make use  of the <code>DeobfuscateMethodEnd()</code> function as de4dot cleans the blocks by removing useless arithmetic instructions and calculates the index value in the proxy calls beforehand.</p>
<p><a href="/img/virtualguard1/proxyil_dg.png" class="gallery-item"><img src="/img/virtualguard1/proxyil_dg.png"></a></p>
<p>We first grab all the methods in the list and also note the list field name. </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; instrCount; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (instrs[i].OpCode == OpCodes.Ldftn)</span><br><span class="line">    &#123;</span><br><span class="line">        objList.Add(instrs[i].Operand <span class="keyword">as</span> IMethod);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (instrs[i].OpCode == OpCodes.Stsfld)</span><br><span class="line">    &#123;</span><br><span class="line">        realObj = instrs[i].Operand <span class="keyword">as</span> FieldDef;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then we can extract the original proxied methods by their index in the object list.  </p>
<p><a href="/img/virtualguard1/proxy_il.png" class="gallery-item"><img src="/img/virtualguard1/proxy_il.png"></a></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; instrCount; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (instrs[i].OpCode == OpCodes.Ldsfld &amp;&amp; instrs[i].Operand == realObj)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> objIdx = instrs[i + <span class="number">1</span>].GetLdcI4Value();</span><br><span class="line">        typesToRemove.Add(blocks.Method.DeclaringType);</span><br><span class="line">        ReplaceMethodCalls(blocks.Method, objList[objIdx]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We replace the proxied method calls with the original ones from the list and also keep noting the types we need to remove from the executable as they are of no use now.<br>We can use the de4dot utility <code>AddTypesToBeRemoved</code> to remove them in the end.<br>We also need to remove the object list as it uses types which are now removed.  </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TypeDef&gt; proxyTypes = proxyCallFixer.Deobfuscate(blocks);</span><br><span class="line">AddTypesToBeRemoved(proxyTypes, <span class="string">&quot;proxies&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>To sum it up, the deobfuscation process looks like the following : </p>
<p><a href="/img/virtualguard1/proxy_calls.png" class="gallery-item"><img src="/img/virtualguard1/proxy_calls.png"></a></p>
<h1 id="Anti-Debug-Remover-üêû"><a href="#Anti-Debug-Remover-üêû" class="headerlink" title="Anti Debug Remover üêû"></a>Anti Debug Remover üêû</h1><p>The Anti Debug method is as follows </p>
<p><a href="/img/virtualguard1/anti-debug-deob.png" class="gallery-item"><img src="/img/virtualguard1/anti-debug-deob.png"></a></p>
<p>It makes use of <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-isdebuggerpresent">IsDebuggerPresent</a>, <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-checkremotedebuggerpresent">CheckRemoteDebuggerPresent</a> APIs &amp; <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.debugger.isattached?view=net-7.0#system-diagnostics-debugger-isattached">IsAttached</a> property to detect the presence of debugger. As it makes use of <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibrary</a> and <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a> functions to invoke those anti debugger methods, we can find their definitions in the ImplMap Table. </p>
<p><a href="/img/virtualguard1/implmap.png" class="gallery-item"><img src="/img/virtualguard1/implmap.png"></a><br>The ImplMap Table contains information about unmanaged functions. Unmanaged functions can be called through managed code with the help of <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/dotnet/standard/native-interop/pinvoke">PInvoke</a>.  </p>
<p>As the proxy calls are now replaced, it is easier to search for methods called by the constructor. Now we just need to create signature of the method.  </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Find</span>(<span class="params">MethodDef realCctor</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (realCctor == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> method <span class="keyword">in</span> DotNetUtils.GetCalledMethods(module, realCctor))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> type = method.DeclaringType;</span><br><span class="line">        <span class="keyword">if</span> (!method.IsStatic || !DotNetUtils.IsMethod(method, <span class="string">&quot;System.Void&quot;</span>, <span class="string">&quot;()&quot;</span>))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (DotNetUtils.GetPInvokeMethod(type, <span class="string">&quot;kernel32&quot;</span>, <span class="string">&quot;LoadLibrary&quot;</span>) == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (DotNetUtils.GetPInvokeMethod(type, <span class="string">&quot;kernel32&quot;</span>, <span class="string">&quot;GetProcAddress&quot;</span>) == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (!DotNetUtils.HasString(method, <span class="string">&quot;IsDebuggerPresent&quot;</span>) &amp;&amp;</span><br><span class="line">            !DotNetUtils.HasString(method, <span class="string">&quot;CheckRemoteDebuggerPresent&quot;</span>) &amp;&amp;</span><br><span class="line">            !DotNetUtils.HasString(method, <span class="string">&quot;get_IsAttached&quot;</span>))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        antiDebuggerType = type;</span><br><span class="line">        antiDebuggerMethod = method;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>I wrote a simple function to find the anti debug method in the executable. It checks whether the method is a simple static method with no parameters and no return value. We verify if the ImplMap contains entries for both LoadLibrary and GetProcAddress. We also search for strings specific to those APIs.</p>
<h1 id="Anti-Tamper-Remover-üî®"><a href="#Anti-Tamper-Remover-üî®" class="headerlink" title="Anti Tamper Remover üî®"></a>Anti Tamper Remover üî®</h1><p>There is also an Anti-Tamper method which checks whether the executable is patched. </p>
<p><a href="/img/virtualguard1/anti-tamper-deob.png" class="gallery-item"><img src="/img/virtualguard1/anti-tamper-deob.png"></a></p>
<p>A MD5 Hash is created using the binary data from the executable except 16 bytes from the end to which it is compared.<br><a href="/img/virtualguard1/checksum.png" class="gallery-item"><img src="/img/virtualguard1/checksum.png"></a></p>
<p>We can verify this by the following commands :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Œª head -c <span class="number">-16</span> test-guarded_spider.exe | md5sum</span><br><span class="line">ccd614578ea1684ef134f47887f1022d *-</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Œª tail -c <span class="number">16</span> test-guarded_spider.exe | xxd -p -c <span class="number">100</span></span><br><span class="line">ccd614578ea1684ef134f47887f1022d</span><br></pre></td></tr></table></figure>
<p>Not spending much time on this, I made a trivial check. I noted all the methods used in the anti tamper method.  </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">List</span>&lt;<span class="title">string</span>&gt; HashCheckMethods</span> = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;() &#123;</span><br><span class="line">            <span class="string">&quot;System.Reflection.Assembly System.Reflection.Assembly::GetExecutingAssembly()&quot;</span>,</span><br><span class="line">            <span class="string">&quot;System.String System.Reflection.Assembly::get_Location()&quot;</span>,</span><br><span class="line">            <span class="string">&quot;System.Security.Cryptography.MD5 System.Security.Cryptography.MD5::Create()&quot;</span>,</span><br><span class="line">            <span class="string">&quot;System.Byte[] System.IO.File::ReadAllBytes(System.String)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;System.Byte[] System.Security.Cryptography.HashAlgorithm::ComputeHash(System.Byte[])&quot;</span></span><br><span class="line">            &#125;;</span><br></pre></td></tr></table></figure>
<p>I just check whether all these methods are being called in any method in the same order and if yes, I mark it as the Anti-Tamper method. I know there could be some false positives but for now I didn‚Äôt feel like spending much on it. </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> method <span class="keyword">in</span> DotNetUtils.GetCalledMethods(module, realCctor))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> allCalls = DotNetUtils.GetMethodCalls(method);</span><br><span class="line">    IEnumerable&lt;<span class="built_in">string</span>&gt; allCallsNames = allCalls.Select(pt =&gt; pt.FullName);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> calledMethodName <span class="keyword">in</span> allCallsNames)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (calledMethodName == HashCheckMethods[i])</span><br><span class="line">            i++;</span><br><span class="line">        <span class="keyword">if</span> (i == HashCheckMethods.Count)</span><br><span class="line">        &#123;</span><br><span class="line">            antiTamperMethod = method;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Success-üí™"><a href="#Success-üí™" class="headerlink" title="Success! üí™"></a>Success! üí™</h1><p>We have now successfully deobfuscated both the crackmes. It will now be easier to analyse other versions of VirtualGuard protected executables. Just FYI, after deobfuscation, the size of the Spider crackme decreased from 151 KB to 27 KB üò±. </p>
<blockquote>
<p>You could download the clean version of the crackmes from the links below :<br><a href="/files/virtualguard/test-guarded_spider-cleaned.exe">Cleaned Spider üï∏</a>   |   <a href="/files/virtualguard/test-guarded_croc-cleaned.exe">Cleaned Crocodile üêä</a><br>I‚Äôve also open sourced the de4dot plugin for VirtualGuard.<br><a target="_blank" rel="noopener" href="https://github.com/mrT4ntr4/de4dot-vg">https://github.com/mrT4ntr4/de4dot-vg</a></p>
</blockquote>
<p>Thanks for making it till here. I hope you learned something from this post. If you find it interesting and want to check out how I devirtualized these crackmes, you could head to the next part in the series <a href="/VirtualGuard-P2/">here</a>.  </p>
<hr>
<h1 id="References-üìö"><a href="#References-üìö" class="headerlink" title="References üìö"></a>References üìö</h1><p><a target="_blank" rel="noopener" href="https://www.codeproject.com/Articles/12585/The-NET-File-Format">https://www.codeproject.com/Articles/12585/The-NET-File-Format</a><br><a target="_blank" rel="noopener" href="https://github.com/NotPrab/.NET-Obfuscator">https://github.com/NotPrab/.NET-Obfuscator</a><br><a target="_blank" rel="noopener" href="https://github.com/NotPrab/.NET-Deobfuscator">https://github.com/NotPrab/.NET-Deobfuscator</a></p>
</div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/categories/">Category</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Initial-Analysis-%F0%9F%94%8D"><span class="toc-number">2.</span> <span class="toc-text">Initial Analysis üîç</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Writing-a-de4dot-Plugin-%F0%9F%94%8C"><span class="toc-number">3.</span> <span class="toc-text">Writing a de4dot Plugin üîå</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cleaning-Control-Flow-%F0%9F%A7%B9"><span class="toc-number">4.</span> <span class="toc-text">Cleaning Control Flow üßπ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fixing-Proxy-Calls-%E2%9B%93%EF%B8%8F"><span class="toc-number">5.</span> <span class="toc-text">Fixing Proxy Calls ‚õìÔ∏è</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Anti-Debug-Remover-%F0%9F%90%9E"><span class="toc-number">6.</span> <span class="toc-text">Anti Debug Remover üêû</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Anti-Tamper-Remover-%F0%9F%94%A8"><span class="toc-number">7.</span> <span class="toc-text">Anti Tamper Remover üî®</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Success-%F0%9F%92%AA"><span class="toc-number">8.</span> <span class="toc-text">Success! üí™</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#References-%F0%9F%93%9A"><span class="toc-number">9.</span> <span class="toc-text">References üìö</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://mrt4ntr4.github.io/VirtualGuard-P1/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&text=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&is_video=false&description=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=A Tale of .Net Deobfuscation - VirtualGuard Basics&body=Check out this article: https://mrt4ntr4.github.io/VirtualGuard-P1/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&title=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://mrt4ntr4.github.io/VirtualGuard-P1/&name=A Tale of .Net Deobfuscation - VirtualGuard Basics&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://mrt4ntr4.github.io/VirtualGuard-P1/&t=A Tale of .Net Deobfuscation - VirtualGuard Basics"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2023
    Suraj Malhotra
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Posts</a></li>
         
          <li><a href="/categories/">Category</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"CTRL+C\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
      setTimeout(function() {
        e.trigger.setAttribute('aria-label', "CTRL+C");
      }, 2000);
    })
  })
  </script>


<script src="/js/main.js"></script>





    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132815766-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-132815766-1');
    </script>








</body>
</html>
